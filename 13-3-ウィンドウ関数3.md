テーブルは13-1で準備したものをそのまま使用する。レコードに順位を付けたい場合は以下の表の関数を使用できる。
|                | ROW_NUMBER                 | RANK                               | DENSE_RANK                             |
| -------------- | -------------------------- | ---------------------------------- | -------------------------------------- |
| 順位付けの方法 | 順序通りに連番を振る       | 同順位があればスキップして順位付け | 同順位があってもスキップせずに順位付け |
| 同順位の扱い   | 同順位でも異なる番号になる | 同順位なら同じ番号                 | 同順位なら同じ番号                     |

以下のクエリでそれぞれ具体的にどのような挙動をしているか確認できる。この他にも、`CUME_DIST`や`PERCENT_RANK`など順位付けに関する様々関数が存在する。必要に応じて[12.21.1 Window 関数の説明](https://dev.mysql.com/doc/refman/8.0/ja/window-function-descriptions.html)を参照する。
```
mysql> select id, total_price,
    -> row_number() over(order by total_price) as "row_number",
    -> rank() over(order by total_price) as "rank",
    -> dense_rank() over(order by total_price) as "dense_rank"
    -> from sales;
+-----+-------------+------------+------+------------+
| id  | total_price | row_number | rank | dense_rank |
+-----+-------------+------------+------+------------+
|  18 |     4000.00 |          1 |    1 |          1 |
|  39 |     4000.00 |          2 |    1 |          1 |
|  63 |     4000.00 |          3 |    1 |          1 |
|  90 |     4000.00 |          4 |    1 |          1 |
|  12 |     4800.00 |          5 |    5 |          2 |
|  33 |     4800.00 |          6 |    5 |          2 |
|  54 |     4800.00 |          7 |    5 |          2 |
|  69 |     4800.00 |          8 |    5 |          2 |
|  81 |     4800.00 |          9 |    5 |          2 |
|  99 |     4800.00 |         10 |    5 |          2 |
|   6 |     5600.00 |         11 |   11 |          3 |
|  27 |     5600.00 |         12 |   11 |          3 |
|  51 |     5600.00 |         13 |   11 |          3 |
|  75 |     5600.00 |         14 |   11 |          3 |
|  96 |     5600.00 |         15 |   11 |          3 |
|   3 |     6400.00 |         16 |   16 |          4 |
|  21 |     6400.00 |         17 |   16 |          4 |
|  24 |     6400.00 |         18 |   16 |          4 |
|  42 |     6400.00 |         19 |   16 |          4 |
|  57 |     6400.00 |         20 |   16 |          4 |
|  78 |     6400.00 |         21 |   16 |          4 |
| 102 |     6400.00 |         22 |   16 |          4 |
|  46 |     7000.00 |         23 |   23 |          5 |
|  45 |     7200.00 |         24 |   24 |          6 |
|  66 |     7200.00 |         25 |   24 |          6 |
|  84 |     7200.00 |         26 |   24 |          6 |
| 105 |     7200.00 |         27 |   24 |          6 |
|   2 |     7500.00 |         28 |   28 |          7 |
|  23 |     7500.00 |         29 |   28 |          7 |
|   9 |     8000.00 |         30 |   30 |          8 |
|  16 |     8000.00 |         31 |   30 |          8 |
|  30 |     8000.00 |         32 |   30 |          8 |
|  37 |     8000.00 |         33 |   30 |          8 |
|  48 |     8000.00 |         34 |   30 |          8 |
|  58 |     8000.00 |         35 |   30 |          8 |
|  60 |     8000.00 |         36 |   30 |          8 |
|  72 |     8000.00 |         37 |   30 |          8 |
|  88 |     8000.00 |         38 |   30 |          8 |
|  93 |     8000.00 |         39 |   30 |          8 |
|   5 |     9000.00 |         40 |   40 |          9 |
|   7 |     9000.00 |         41 |   40 |          9 |
|  26 |     9000.00 |         42 |   40 |          9 |
|  28 |     9000.00 |         43 |   40 |          9 |
|  44 |     9000.00 |         44 |   40 |          9 |
|  55 |     9000.00 |         45 |   40 |          9 |
|  62 |     9000.00 |         46 |   40 |          9 |
|  73 |     9000.00 |         47 |   40 |          9 |
|  77 |     9000.00 |         48 |   40 |          9 |
|  95 |     9000.00 |         49 |   40 |          9 |
|  97 |     9000.00 |         50 |   40 |          9 |
|  15 |     9600.00 |         51 |   51 |         10 |
|  36 |     9600.00 |         52 |   51 |         10 |
|  87 |     9600.00 |         53 |   51 |         10 |
|   1 |    10000.00 |         54 |   54 |         11 |
|  22 |    10000.00 |         55 |   54 |         11 |
|  49 |    10000.00 |         56 |   54 |         11 |
|  67 |    10000.00 |         57 |   54 |         11 |
|  79 |    10000.00 |         58 |   54 |         11 |
| 100 |    10000.00 |         59 |   54 |         11 |
|  11 |    10500.00 |         60 |   60 |         12 |
|  32 |    10500.00 |         61 |   60 |         12 |
|  59 |    10500.00 |         62 |   60 |         12 |
|  71 |    10500.00 |         63 |   60 |         12 |
|  89 |    10500.00 |         64 |   60 |         12 |
| 104 |    10500.00 |         65 |   60 |         12 |
|  10 |    11000.00 |         66 |   66 |         13 |
|  31 |    11000.00 |         67 |   66 |         13 |
|  64 |    11000.00 |         68 |   66 |         13 |
|  82 |    11000.00 |         69 |   66 |         13 |
| 103 |    11000.00 |         70 |   66 |         13 |
|   4 |    12000.00 |         71 |   71 |         14 |
|   8 |    12000.00 |         72 |   71 |         14 |
|  25 |    12000.00 |         73 |   71 |         14 |
|  29 |    12000.00 |         74 |   71 |         14 |
|  47 |    12000.00 |         75 |   71 |         14 |
|  52 |    12000.00 |         76 |   71 |         14 |
|  68 |    12000.00 |         77 |   71 |         14 |
|  76 |    12000.00 |         78 |   71 |         14 |
|  83 |    12000.00 |         79 |   71 |         14 |
|  94 |    12000.00 |         80 |   71 |         14 |
|  98 |    12000.00 |         81 |   71 |         14 |
|  19 |    13000.00 |         82 |   82 |         15 |
|  40 |    13000.00 |         83 |   82 |         15 |
|  70 |    13000.00 |         84 |   82 |         15 |
|  91 |    13000.00 |         85 |   82 |         15 |
|  14 |    13500.00 |         86 |   86 |         16 |
|  35 |    13500.00 |         87 |   86 |         16 |
|  53 |    13500.00 |         88 |   86 |         16 |
|  80 |    13500.00 |         89 |   86 |         16 |
|  92 |    13500.00 |         90 |   86 |         16 |
|  43 |    14000.00 |         91 |   91 |         17 |
|  61 |    14000.00 |         92 |   91 |         17 |
|  13 |    15000.00 |         93 |   93 |         18 |
|  17 |    15000.00 |         94 |   93 |         18 |
|  34 |    15000.00 |         95 |   93 |         18 |
|  38 |    15000.00 |         96 |   93 |         18 |
|  85 |    15000.00 |         97 |   93 |         18 |
|  86 |    15000.00 |         98 |   93 |         18 |
|  50 |    16500.00 |         99 |   99 |         19 |
|  74 |    16500.00 |        100 |   99 |         19 |
|  20 |    18000.00 |        101 |  101 |         20 |
|  41 |    18000.00 |        102 |  101 |         20 |
|  65 |    18000.00 |        103 |  101 |         20 |
| 101 |    18000.00 |        104 |  101 |         20 |
|  56 |    19500.00 |        105 |  105 |         21 |
+-----+-------------+------------+------+------------+
```
`LAG`や`LEAD`を用いると、ソートした後に前後に存在するレコードを付与することができる。
```
mysql> select id, total_price,
    -> lag(total_price) over(order by id) as "1つ前", -- id=1の前は存在しないのでNULL, id=2にはid=1のtotal_price
    -> lead(total_price) over(order by id) as "1つ後", -- id=1にはid=2のtotal_price, id=2にはid=3のtotal_price
    -> lag(total_price, 3, 0) over(order by id) as "3つ前、ない場合は0"
    -> from sales;
+-----+-------------+----------+----------+----------------------------+
| id  | total_price | 1つ前    | 1つ後    | 3つ前、ない場合は0         |
+-----+-------------+----------+----------+----------------------------+
|   1 |    10000.00 |     NULL |  7500.00 |                       0.00 |
|   2 |     7500.00 | 10000.00 |  6400.00 |                       0.00 |
|   3 |     6400.00 |  7500.00 | 12000.00 |                       0.00 |
|   4 |    12000.00 |  6400.00 |  9000.00 |                   10000.00 |
|   5 |     9000.00 | 12000.00 |  5600.00 |                    7500.00 |
|   6 |     5600.00 |  9000.00 |  9000.00 |                    6400.00 |
|   7 |     9000.00 |  5600.00 | 12000.00 |                   12000.00 |
|   8 |    12000.00 |  9000.00 |  8000.00 |                    9000.00 |
|   9 |     8000.00 | 12000.00 | 11000.00 |                    5600.00 |
|  10 |    11000.00 |  8000.00 | 10500.00 |                    9000.00 |
|  11 |    10500.00 | 11000.00 |  4800.00 |                   12000.00 |
|  12 |     4800.00 | 10500.00 | 15000.00 |                    8000.00 |
|  13 |    15000.00 |  4800.00 | 13500.00 |                   11000.00 |
|  14 |    13500.00 | 15000.00 |  9600.00 |                   10500.00 |
|  15 |     9600.00 | 13500.00 |  8000.00 |                    4800.00 |
|  16 |     8000.00 |  9600.00 | 15000.00 |                   15000.00 |
|  17 |    15000.00 |  8000.00 |  4000.00 |                   13500.00 |
|  18 |     4000.00 | 15000.00 | 13000.00 |                    9600.00 |
|  19 |    13000.00 |  4000.00 | 18000.00 |                    8000.00 |
|  20 |    18000.00 | 13000.00 |  6400.00 |                   15000.00 |
|  21 |     6400.00 | 18000.00 | 10000.00 |                    4000.00 |
|  22 |    10000.00 |  6400.00 |  7500.00 |                   13000.00 |
|  23 |     7500.00 | 10000.00 |  6400.00 |                   18000.00 |
|  24 |     6400.00 |  7500.00 | 12000.00 |                    6400.00 |
|  25 |    12000.00 |  6400.00 |  9000.00 |                   10000.00 |
|  26 |     9000.00 | 12000.00 |  5600.00 |                    7500.00 |
|  27 |     5600.00 |  9000.00 |  9000.00 |                    6400.00 |
|  28 |     9000.00 |  5600.00 | 12000.00 |                   12000.00 |
|  29 |    12000.00 |  9000.00 |  8000.00 |                    9000.00 |
|  30 |     8000.00 | 12000.00 | 11000.00 |                    5600.00 |
|  31 |    11000.00 |  8000.00 | 10500.00 |                    9000.00 |
|  32 |    10500.00 | 11000.00 |  4800.00 |                   12000.00 |
|  33 |     4800.00 | 10500.00 | 15000.00 |                    8000.00 |
|  34 |    15000.00 |  4800.00 | 13500.00 |                   11000.00 |
|  35 |    13500.00 | 15000.00 |  9600.00 |                   10500.00 |
|  36 |     9600.00 | 13500.00 |  8000.00 |                    4800.00 |
|  37 |     8000.00 |  9600.00 | 15000.00 |                   15000.00 |
|  38 |    15000.00 |  8000.00 |  4000.00 |                   13500.00 |
|  39 |     4000.00 | 15000.00 | 13000.00 |                    9600.00 |
|  40 |    13000.00 |  4000.00 | 18000.00 |                    8000.00 |
|  41 |    18000.00 | 13000.00 |  6400.00 |                   15000.00 |
|  42 |     6400.00 | 18000.00 | 14000.00 |                    4000.00 |
|  43 |    14000.00 |  6400.00 |  9000.00 |                   13000.00 |
|  44 |     9000.00 | 14000.00 |  7200.00 |                   18000.00 |
|  45 |     7200.00 |  9000.00 |  7000.00 |                    6400.00 |
|  46 |     7000.00 |  7200.00 | 12000.00 |                   14000.00 |
|  47 |    12000.00 |  7000.00 |  8000.00 |                    9000.00 |
|  48 |     8000.00 | 12000.00 | 10000.00 |                    7200.00 |
|  49 |    10000.00 |  8000.00 | 16500.00 |                    7000.00 |
|  50 |    16500.00 | 10000.00 |  5600.00 |                   12000.00 |
|  51 |     5600.00 | 16500.00 | 12000.00 |                    8000.00 |
|  52 |    12000.00 |  5600.00 | 13500.00 |                   10000.00 |
|  53 |    13500.00 | 12000.00 |  4800.00 |                   16500.00 |
|  54 |     4800.00 | 13500.00 |  9000.00 |                    5600.00 |
|  55 |     9000.00 |  4800.00 | 19500.00 |                   12000.00 |
|  56 |    19500.00 |  9000.00 |  6400.00 |                   13500.00 |
|  57 |     6400.00 | 19500.00 |  8000.00 |                    4800.00 |
|  58 |     8000.00 |  6400.00 | 10500.00 |                    9000.00 |
|  59 |    10500.00 |  8000.00 |  8000.00 |                   19500.00 |
|  60 |     8000.00 | 10500.00 | 14000.00 |                    6400.00 |
|  61 |    14000.00 |  8000.00 |  9000.00 |                    8000.00 |
|  62 |     9000.00 | 14000.00 |  4000.00 |                   10500.00 |
|  63 |     4000.00 |  9000.00 | 11000.00 |                    8000.00 |
|  64 |    11000.00 |  4000.00 | 18000.00 |                   14000.00 |
|  65 |    18000.00 | 11000.00 |  7200.00 |                    9000.00 |
|  66 |     7200.00 | 18000.00 | 10000.00 |                    4000.00 |
|  67 |    10000.00 |  7200.00 | 12000.00 |                   11000.00 |
|  68 |    12000.00 | 10000.00 |  4800.00 |                   18000.00 |
|  69 |     4800.00 | 12000.00 | 13000.00 |                    7200.00 |
|  70 |    13000.00 |  4800.00 | 10500.00 |                   10000.00 |
|  71 |    10500.00 | 13000.00 |  8000.00 |                   12000.00 |
|  72 |     8000.00 | 10500.00 |  9000.00 |                    4800.00 |
|  73 |     9000.00 |  8000.00 | 16500.00 |                   13000.00 |
|  74 |    16500.00 |  9000.00 |  5600.00 |                   10500.00 |
|  75 |     5600.00 | 16500.00 | 12000.00 |                    8000.00 |
|  76 |    12000.00 |  5600.00 |  9000.00 |                    9000.00 |
|  77 |     9000.00 | 12000.00 |  6400.00 |                   16500.00 |
|  78 |     6400.00 |  9000.00 | 10000.00 |                    5600.00 |
|  79 |    10000.00 |  6400.00 | 13500.00 |                   12000.00 |
|  80 |    13500.00 | 10000.00 |  4800.00 |                    9000.00 |
|  81 |     4800.00 | 13500.00 | 11000.00 |                    6400.00 |
|  82 |    11000.00 |  4800.00 | 12000.00 |                   10000.00 |
|  83 |    12000.00 | 11000.00 |  7200.00 |                   13500.00 |
|  84 |     7200.00 | 12000.00 | 15000.00 |                    4800.00 |
|  85 |    15000.00 |  7200.00 | 15000.00 |                   11000.00 |
|  86 |    15000.00 | 15000.00 |  9600.00 |                   12000.00 |
|  87 |     9600.00 | 15000.00 |  8000.00 |                    7200.00 |
|  88 |     8000.00 |  9600.00 | 10500.00 |                   15000.00 |
|  89 |    10500.00 |  8000.00 |  4000.00 |                   15000.00 |
|  90 |     4000.00 | 10500.00 | 13000.00 |                    9600.00 |
|  91 |    13000.00 |  4000.00 | 13500.00 |                    8000.00 |
|  92 |    13500.00 | 13000.00 |  8000.00 |                   10500.00 |
|  93 |     8000.00 | 13500.00 | 12000.00 |                    4000.00 |
|  94 |    12000.00 |  8000.00 |  9000.00 |                   13000.00 |
|  95 |     9000.00 | 12000.00 |  5600.00 |                   13500.00 |
|  96 |     5600.00 |  9000.00 |  9000.00 |                    8000.00 |
|  97 |     9000.00 |  5600.00 | 12000.00 |                   12000.00 |
|  98 |    12000.00 |  9000.00 |  4800.00 |                    9000.00 |
|  99 |     4800.00 | 12000.00 | 10000.00 |                    5600.00 |
| 100 |    10000.00 |  4800.00 | 18000.00 |                    9000.00 |
| 101 |    18000.00 | 10000.00 |  6400.00 |                   12000.00 |
| 102 |     6400.00 | 18000.00 | 11000.00 |                    4800.00 |
| 103 |    11000.00 |  6400.00 | 10500.00 |                   10000.00 |
| 104 |    10500.00 | 11000.00 |  7200.00 |                   18000.00 |
| 105 |     7200.00 | 10500.00 |     NULL |                    6400.00 |
+-----+-------------+----------+----------+----------------------------+
```
以下のクエリのように前日と売り上げ差分を計算することもできる。
```
mysql> with daily_sale as (
    ->     select sale_date, sum(total_price) as daily_total_price
    ->     from sales
    ->     group by sale_date
    -> )
    -> select sale_date,
    -> daily_total_price,
    -> lag(daily_total_price) over(order by sale_date) as "前日の売り上げ",
    -> daily_total_price - lag(daily_total_price) over(order by sale_date) as "前日と売り上げ差分"
    -> from daily_sale;
+------------+-------------------+-----------------------+-----------------------------+
| sale_date  | daily_total_price | 前日の売り上げ        | 前日と売り上げ差分          |
+------------+-------------------+-----------------------+-----------------------------+
| 2024-02-01 |          47800.00 |                  NULL |                        NULL |
| 2024-02-02 |          53200.00 |              47800.00 |                     5400.00 |
| 2024-02-03 |          58000.00 |              53200.00 |                     4800.00 |
| 2024-02-04 |          52600.00 |              58000.00 |                    -5400.00 |
| 2024-02-05 |          76200.00 |              52600.00 |                    23600.00 |
| 2024-02-06 |          54000.00 |              76200.00 |                   -22200.00 |
| 2024-02-07 |          74800.00 |              54000.00 |                    20800.00 |
| 2024-02-08 |          30200.00 |              74800.00 |                   -44600.00 |
| 2024-02-09 |          27000.00 |              30200.00 |                    -3200.00 |
| 2024-02-10 |          32100.00 |              27000.00 |                     5100.00 |
| 2024-02-11 |          30300.00 |              32100.00 |                    -1800.00 |
| 2024-02-12 |          34900.00 |              30300.00 |                     4600.00 |
| 2024-02-13 |          26500.00 |              34900.00 |                    -8400.00 |
| 2024-02-14 |          27000.00 |              26500.00 |                      500.00 |
| 2024-02-15 |          36200.00 |              27000.00 |                     9200.00 |
| 2024-02-16 |          26800.00 |              36200.00 |                    -9400.00 |
| 2024-02-17 |          31500.00 |              26800.00 |                     4700.00 |
| 2024-02-18 |          31100.00 |              31500.00 |                     -400.00 |
| 2024-02-19 |          27400.00 |              31100.00 |                    -3700.00 |
| 2024-02-20 |          28300.00 |              27400.00 |                      900.00 |
| 2024-02-21 |          30200.00 |              28300.00 |                     1900.00 |
| 2024-02-22 |          39600.00 |              30200.00 |                     9400.00 |
| 2024-02-23 |          22500.00 |              39600.00 |                   -17100.00 |
| 2024-02-24 |          34500.00 |              22500.00 |                    12000.00 |
| 2024-02-25 |          26600.00 |              34500.00 |                    -7900.00 |
| 2024-02-26 |          25800.00 |              26600.00 |                     -800.00 |
| 2024-02-27 |          34400.00 |              25800.00 |                     8600.00 |
| 2024-02-28 |          28700.00 |              34400.00 |                    -5700.00 |
+------------+-------------------+-----------------------+-----------------------------+
```